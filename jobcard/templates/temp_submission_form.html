def temp_submission(request):
    today = timezone.localdate()
    user = request.user if request.user.is_authenticated else None
    shift = request.GET.get("shift", "Day")

    # ---------- AJAX SAVE ----------
    if request.method == "POST" and request.headers.get("x-requested-with") == "XMLHttpRequest":
        line = request.POST.get("line")

        obj, created = TempSubmission.objects.get_or_create(
            operator=user,
            date=today,
            shift=shift,
            line=line
        )

        form = TempSubmissionForm(request.POST, instance=obj)

        if form.is_valid():
            saved = form.save()
            return JsonResponse({"total": saved.total_output()})

        return JsonResponse({"error": "Invalid data"}, status=400)

    # ---------- PAGE LOAD ----------
    lines = ["line1","line2","line3","line4","line5","line6","line7"]
    forms_data = []

    for line in lines:
        obj, created = TempSubmission.objects.get_or_create(
            operator=user,
            date=today,
            shift=shift,
            line=line
        )
        form = TempSubmissionForm(instance=obj)
        forms_data.append((line, form, obj))

    return render(request, "temp_submission_form.html", {
        "forms_data": forms_data,
        "shift": shift
    })

    <script>
document.querySelectorAll(".line-form").forEach(form=>{
    const inputs = form.querySelectorAll("input[type=number]");
    const totalEl = form.querySelector(".total-value");
    const line = form.dataset.line;

    function calc(){
        let t=0;
        inputs.forEach(i=> { if(i.value) t+=parseInt(i.value)||0; });
        totalEl.textContent = t;
    }

    inputs.forEach(i=>{
        i.addEventListener("input", ()=>{
            calc();

            // Send only this line's form data via AJAX
            const fd = new FormData(form);
            fetch("?shift={{shift}}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": form.querySelector("[name=csrfmiddlewaretoken]").value,
                    "X-Requested-With": "XMLHttpRequest"
                },
                body: fd
            });
        });
    });

    calc(); // initialize totals on load
});
</script>
